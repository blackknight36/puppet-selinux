# ***** THIS FILE IS MANAGED BY PUPPET *****
#
# vim:filetype=configparser foldmethod=marker
#
# modules/dart/files/mirrmaid/mayflower-fanout.conf
#
# mirrmaid configuration
#
# See the Python documentation for ConfigParser for full details, but in
# general you assign values with either 'key: value' or 'key = value'.  Values
# may be continued on successive lines provided they begin with one or more
# whitespace characters.  Leading and trailing whitespace is trimmed. Because
# of the interpolation features of ConfigParser, any percent signs (%) that
# are to be taken as such, must be doubled (%%).


[MIRRMAID]  # {{{1

### Operations Summary Controls ###

# Since mirrmaid is not a daemon, it only runs as scheduled by cron (or other
# means).  Thus the operations summaries cannot be triggered and sent
# unless/until mirrmaid is actually running.  Keep this in mind when
# considering the following options.

# summary_recipients is a list of email addresses to whom the operations
# summaries should be sent.  If set, this must be a valid Python list.
#
# OPTIONAL; DEFAULT IS
summary_recipients: ["john.florian@dart.biz",]

# This option controls the minimum number of seconds that mirrmaid will wait
# after sending an operations summary via email before sending another.
# A minimum value of ten minutes is silently enforced.
#
# OPTIONAL; DEFAULT IS (24 hours)
#summary_interval: 86400

# If the size (in bytes) of the operations summary has exceeded the
# {summary_interval} threshold, the email will be sent early without
# necessarily waiting for the {summary_interval} to have elapsed.  This can be
# useful to alert the {summary_recipients} of major trouble in a more
# expedient way.  Set this to zero to defeat this feature.
#
# OPTIONAL; DEFAULT IS
#summary_size: 20000

# mirrmaid will keep {summary_history_count} historical copies of operational
# summaries on disk before they are rotated out of existence.  A minimum value
# of one is silently enforced.
#
# OPTIONAL; DEFAULT IS
#summary_history_count: 3

# If you have multiple mirrmaid configurations/jobs established on a single
# host, you may wish to keep the operations summaries distinct for each.  Each
# {summary_group} will result in a distinct operations summary and may be
# shared among any number of configurations/jobs.  The value of
# {summary_group} can be anything you wish.  It will be included in the email
# subject like so:
#       mirrmaid Activity Summary for {summary_group}
#
# OPTIONAL; DEFAULT IS
summary_group: Mayflower Fanout Mirrors (Plant-Local Mirrors of Mayflower Payload Area)

# 1}}}

[DEFAULT]   # {{{1

# rsync_options -- REQUIRED
# General options to be passed to rsync.  Note that order can be important, as
# some options may override some or all of others.
rsync_options: [
    "--archive",
    "--bwlimit=128",
    "--delay-updates",
    "--delete-after",       # TODO: use --delete-delay after remotes are updated
    "--delete-excluded",
    "--hard-links",
    "--partial-dir", ".rsync-partial",
    "--stats",
    "--verbose",

    # These MUST be kept after the above!
    "--no-group",
    "--no-owner",

    # This is useful to enable prior to making any significant change here.
    #"--dry-run",
    ]

# Here you may define other values for reuse in other sections.  To use the
# values, simply use the pattern '%(name)s'.  Values defined here in the DEFAULT
# section are unique in that they may be used in any other section.  In essence,
# their global whereas in any other section, they're local.

# tokens for mirroring the mayflower payload area {{{2
def_source: /pub
def_target: /local/mirrors

mirror_target_0001pi: mdct-01pi:%(def_target)s
mirror_target_0002pi: mdct-02pi:%(def_target)s
mirror_target_0003pi: mdct-03pi:%(def_target)s
mirror_target_0004pi: mdct-04pi:%(def_target)s
mirror_target_0005pi: mdct-05pi:%(def_target)s
mirror_target_0010pi: mdct-10pi:%(def_target)s
mirror_target_0011pi: mdct-11pi:%(def_target)s
mirror_target_0015pi: mdct-15pi:%(def_target)s
mirror_target_0019pi: mdct-19pi:%(def_target)s
mirror_target_0025pi: mdct-25pi:%(def_target)s
mirror_target_0039pi: mdct-39pi:%(def_target)s
mirror_target_0047pi: mdct-47pi:%(def_target)s
mirror_target_0052pi: mdct-52pi:%(def_target)s
mirror_target_0055pi: mdct-55pi:%(def_target)s
mirror_target_0072pi: mdct-72pi:%(def_target)s
mirror_target_0073pi: mdct-73pi:%(def_target)s
mirror_target_0075pi: mdct-75pi:%(def_target)s
mirror_target_0076pi: mdct-76pi:%(def_target)s
mirror_target_0077pi: mdct-77pi:%(def_target)s
mirror_target_0078pi: mdct-78pi:%(def_target)s
mirror_target_0302pi: mdct-0302pi:%(def_target)s
mirror_target_0310pi: mdct-0310pi:%(def_target)s
mirror_target_0314pi: mdct-0314pi:%(def_target)s
mirror_target_0377pi: mdct-0377pi:%(def_target)s

# 2}}}

# tokens for mirroring the mayflower payload area {{{2
def_mayflower_branch: mdct-aos-flash/mayflower
def_mayflower_includes: [ ]
def_mayflower_excludes: [ ]

# 2}}}

# 1}}}

[MIRRORS]   # {{{1

# enabled -- REQUIRED
# Names of mirrors to be managed.  Each named mirror requires its own named
# section with details for that mirror.  Mirrors will be synchronized in the
# order listed here.
enabled: [
    "mayflower-pay-0001pi",
    "mayflower-pay-0002pi",
    "mayflower-pay-0003pi",
    "mayflower-pay-0004pi",
    "mayflower-pay-0005pi",
    "mayflower-pay-0010pi",
    "mayflower-pay-0011pi",
    "mayflower-pay-0015pi",
    "mayflower-pay-0019pi",
    "mayflower-pay-0025pi",
    "mayflower-pay-0039pi",
    "mayflower-pay-0047pi",
    "mayflower-pay-0052pi",
    "mayflower-pay-0055pi",
    "mayflower-pay-0072pi",
    "mayflower-pay-0073pi",
    "mayflower-pay-0075pi",
    "mayflower-pay-0076pi",
    "mayflower-pay-0077pi",
    "mayflower-pay-0078pi",
    "mayflower-pay-0302pi",
    "mayflower-pay-0310pi",
    "mayflower-pay-0314pi",
    "mayflower-pay-0377pi",
    ]


# Define each mirror below.  At a minimum, each enabled mirror must be defined
# and must provide the following keys:
#       source          The rsync URI of what is to be mirrored.
#       target          The rsync URI of where the mirror is to be kept.
#       include         A Python list of patterns to be included in the
#                       mirror.
#       exclude         A Python list of patterns to be excluded from the
#                       mirror.


# mirrors for the mayflower payload area {{{2

[mayflower-pay-0001pi]
source: %(def_source)s/%(def_mayflower_branch)s
target: %(mirror_target_0001pi)s/%(def_mayflower_branch)s
include: %(def_mayflower_includes)s
exclude: %(def_mayflower_excludes)s

[mayflower-pay-0002pi]
source: %(def_source)s/%(def_mayflower_branch)s
target: %(mirror_target_0002pi)s/%(def_mayflower_branch)s
include: %(def_mayflower_includes)s
exclude: %(def_mayflower_excludes)s

[mayflower-pay-0003pi]
source: %(def_source)s/%(def_mayflower_branch)s
target: %(mirror_target_0003pi)s/%(def_mayflower_branch)s
include: %(def_mayflower_includes)s
exclude: %(def_mayflower_excludes)s

[mayflower-pay-0004pi]
source: %(def_source)s/%(def_mayflower_branch)s
target: %(mirror_target_0004pi)s/%(def_mayflower_branch)s
include: %(def_mayflower_includes)s
exclude: %(def_mayflower_excludes)s

[mayflower-pay-0005pi]
source: %(def_source)s/%(def_mayflower_branch)s
target: %(mirror_target_0005pi)s/%(def_mayflower_branch)s
include: %(def_mayflower_includes)s
exclude: %(def_mayflower_excludes)s

[mayflower-pay-0010pi]
source: %(def_source)s/%(def_mayflower_branch)s
target: %(mirror_target_0010pi)s/%(def_mayflower_branch)s
include: %(def_mayflower_includes)s
exclude: %(def_mayflower_excludes)s

[mayflower-pay-0011pi]
source: %(def_source)s/%(def_mayflower_branch)s
target: %(mirror_target_0011pi)s/%(def_mayflower_branch)s
include: %(def_mayflower_includes)s
exclude: %(def_mayflower_excludes)s

[mayflower-pay-0015pi]
source: %(def_source)s/%(def_mayflower_branch)s
target: %(mirror_target_0015pi)s/%(def_mayflower_branch)s
include: %(def_mayflower_includes)s
exclude: %(def_mayflower_excludes)s

[mayflower-pay-0019pi]
source: %(def_source)s/%(def_mayflower_branch)s
target: %(mirror_target_0019pi)s/%(def_mayflower_branch)s
include: %(def_mayflower_includes)s
exclude: %(def_mayflower_excludes)s

[mayflower-pay-0025pi]
source: %(def_source)s/%(def_mayflower_branch)s
target: %(mirror_target_0025pi)s/%(def_mayflower_branch)s
include: %(def_mayflower_includes)s
exclude: %(def_mayflower_excludes)s

[mayflower-pay-0039pi]
source: %(def_source)s/%(def_mayflower_branch)s
target: %(mirror_target_0039pi)s/%(def_mayflower_branch)s
include: %(def_mayflower_includes)s
exclude: %(def_mayflower_excludes)s

[mayflower-pay-0047pi]
source: %(def_source)s/%(def_mayflower_branch)s
target: %(mirror_target_0047pi)s/%(def_mayflower_branch)s
include: %(def_mayflower_includes)s
exclude: %(def_mayflower_excludes)s

[mayflower-pay-0052pi]
source: %(def_source)s/%(def_mayflower_branch)s
target: %(mirror_target_0052pi)s/%(def_mayflower_branch)s
include: %(def_mayflower_includes)s
exclude: %(def_mayflower_excludes)s

[mayflower-pay-0055pi]
source: %(def_source)s/%(def_mayflower_branch)s
target: %(mirror_target_0055pi)s/%(def_mayflower_branch)s
include: %(def_mayflower_includes)s
exclude: %(def_mayflower_excludes)s

[mayflower-pay-0072pi]
source: %(def_source)s/%(def_mayflower_branch)s
target: %(mirror_target_0072pi)s/%(def_mayflower_branch)s
include: %(def_mayflower_includes)s
exclude: %(def_mayflower_excludes)s

[mayflower-pay-0073pi]
source: %(def_source)s/%(def_mayflower_branch)s
target: %(mirror_target_0073pi)s/%(def_mayflower_branch)s
include: %(def_mayflower_includes)s
exclude: %(def_mayflower_excludes)s

[mayflower-pay-0075pi]
source: %(def_source)s/%(def_mayflower_branch)s
target: %(mirror_target_0075pi)s/%(def_mayflower_branch)s
include: %(def_mayflower_includes)s
exclude: %(def_mayflower_excludes)s

[mayflower-pay-0076pi]
source: %(def_source)s/%(def_mayflower_branch)s
target: %(mirror_target_0076pi)s/%(def_mayflower_branch)s
include: %(def_mayflower_includes)s
exclude: %(def_mayflower_excludes)s

[mayflower-pay-0077pi]
source: %(def_source)s/%(def_mayflower_branch)s
target: %(mirror_target_0077pi)s/%(def_mayflower_branch)s
include: %(def_mayflower_includes)s
exclude: %(def_mayflower_excludes)s

[mayflower-pay-0078pi]
source: %(def_source)s/%(def_mayflower_branch)s
target: %(mirror_target_0078pi)s/%(def_mayflower_branch)s
include: %(def_mayflower_includes)s
exclude: %(def_mayflower_excludes)s

[mayflower-pay-0302pi]
source: %(def_source)s/%(def_mayflower_branch)s
target: %(mirror_target_0302pi)s/%(def_mayflower_branch)s
include: %(def_mayflower_includes)s
exclude: %(def_mayflower_excludes)s

[mayflower-pay-0310pi]
source: %(def_source)s/%(def_mayflower_branch)s
target: %(mirror_target_0310pi)s/%(def_mayflower_branch)s
include: %(def_mayflower_includes)s
exclude: %(def_mayflower_excludes)s

[mayflower-pay-0314pi]
source: %(def_source)s/%(def_mayflower_branch)s
target: %(mirror_target_0314pi)s/%(def_mayflower_branch)s
include: %(def_mayflower_includes)s
exclude: %(def_mayflower_excludes)s

[mayflower-pay-0377pi]
source: %(def_source)s/%(def_mayflower_branch)s
target: %(mirror_target_0377pi)s/%(def_mayflower_branch)s
include: %(def_mayflower_includes)s
exclude: %(def_mayflower_excludes)s

# 2}}}

# 1}}}
